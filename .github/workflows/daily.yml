name: PR Volume Spike Monitor (3x Daily)

on:
  schedule:
    # Morning: 15:30 UTC = 10:30 AM EST / 7:30 AM PST
    # Catches overnight & pre-market PR-driven spikes in the first hour of trading
    - cron: '30 15 * * 1-5'
    # Midday:  18:00 UTC =  1:00 PM EST / 10:00 AM PST
    # Catches midday spikes as volume patterns crystallize
    - cron: '0 18 * * 1-5'
    # Closing: 21:15 UTC =  4:15 PM EST / 1:15 PM PST
    # Final sweep after market close with settled data
    - cron: '15 21 * * 1-5'
  workflow_dispatch:

jobs:
  run-monitor:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.11'
          cache: 'pip'

      - name: Install Dependencies
        run: |
          pip install -r requirements.txt

      - name: Run Monitor
        env:
          SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
        run: |
          # Set python path to current directory so src modules can be imported
          export PYTHONPATH=$PYTHONPATH:.
          python src/main.py

      - name: Upload Report Artifacts
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: report-${{ github.run_id }}
          path: daily_report_*.json
